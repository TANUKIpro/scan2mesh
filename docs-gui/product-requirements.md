# プロダクト要求定義書 (Product Requirements Document)

## プロダクト概要

### 名称
**scan2mesh GUI** - 3Dスキャンパイプラインのビジュアルインターフェース

### プロダクトコンセプト
- **ワンストップ3Dスキャン管理**: デバイス接続確認から3Dモデル出力まで、すべての工程をGUIで完結
- **プロファイルベースのオブジェクト管理**: 複数の3Dスキャン対象を体系的に登録・管理・呼び出し
- **リアルタイムフィードバック**: 撮影品質、復元進捗、品質ゲート判定をビジュアルで即座に確認

### プロダクトビジョン
scan2mesh GUIは、既存のscan2mesh CLIパイプラインをGUIから操作可能にするStreamlitベースのWebアプリケーションです。ロボティクスエンジニアやMLエンジニアが、コマンドラインの知識なしに3Dスキャンパイプラインを直感的に操作できる環境を提供します。hsr-perception-robocupと同様の統一されたUI/UXにより、同じチームが両ツールを違和感なく使用できます。GPU非搭載の環境でも動作し、Dockerコンテナで環境を汚さずに実行できます。

### 目的
- scan2meshの8ステージパイプラインをGUIから実行可能にする
- プロファイル管理により、複数オブジェクトの3Dスキャンプロジェクトを体系的に管理する
- デバイス接続状態やGPU利用可否をリアルタイムで確認し、トラブルシューティングを容易にする
- hsr-perception-robocupと同様のUI/UXを提供し、学習コストを最小化する
- CPU環境でも動作可能にし、幅広い環境での利用を可能にする

## ターゲットユーザー

### プライマリーペルソナ: 佐藤健太（32歳、ロボティクスエンジニア）
- **属性**: ロボカップやロボット競技会に参加するチームのエンジニア
- **技術スタック**: ROS2、Python、C++、シミュレータ（Gazebo、Isaac Sim等）
- **現在の課題**:
  - CLIでの3Dスキャン操作は習得コストが高い
  - パイプラインの各ステージの状態把握が難しい
  - 複数の物体をスキャンする際の管理が煩雑
  - hsr-perception-robocupは使い慣れているが、scan2meshは別のUIで操作しにくい
- **期待する解決策**: 使い慣れたStreamlit UIでscan2meshを操作したい。プロファイル管理で複数物体を効率的にスキャンしたい
- **1日の典型的なワークフロー**:
  1. 朝: 競技で使う物体の3Dモデルをスキャン
  2. 昼: シミュレータでのテスト、問題点の洗い出し
  3. 夕: 追加スキャン、モデルの改善

### セカンダリーペルソナ: 山田花子（28歳、MLエンジニア）
- **属性**: 物体認識モデルの学習データを作成するMLエンジニア
- **技術スタック**: PyTorch、BlenderProc、合成データ生成パイプライン
- **現在の課題**:
  - CLIツールに不慣れで、scan2meshの操作に時間がかかる
  - スキャン品質の判定が視覚的に確認できない
  - 大量の物体をスキャンする際の進捗管理が困難
- **期待する解決策**: GUIで直感的に操作でき、品質レポートをビジュアルで確認したい

## 成功指標（KPI）

### プライマリーKPI
- **初回スキャン成功率**: GUIを使用した初回ユーザーが、30分以内に最初のスキャンを完了できる割合 ≥ 80%
- **パイプライン完走率**: 開始したパイプラインが品質ゲートPASSで完了する割合 ≥ 70%
- **操作効率**: 同等のタスクをCLIで実行する場合と比較して、操作時間が同等以下

### セカンダリーKPI
- **UI習得時間**: hsr-perception-robocup経験者が、scan2mesh GUIの全機能を把握するまでの時間 ≤ 15分
- **エラー解決率**: エラー発生時に、GUI上の情報だけで解決できる割合 ≥ 60%

## 機能要件

### コア機能（MVP）

#### 1. ダッシュボード（Dashboard）

**ユーザーストーリー**:
ロボティクスエンジニアとして、パイプライン全体の状態を一目で把握するために、ダッシュボードが欲しい

**受け入れ条件**:
- [ ] 登録済みプロファイル数、オブジェクト数を表示できる
- [ ] 各オブジェクトのパイプライン進捗状態（Init/Plan/Capture/...）を表示できる
- [ ] 最近のスキャン履歴（直近10件）を表示できる
- [ ] システム状態（RealSense接続、GPU利用可否）を表示できる
- [ ] 品質ゲートの統計（PASS/WARN/FAIL件数）を表示できる

**優先度**: P0（必須）

#### 2. プロファイル管理（Profiles）

**ユーザーストーリー**:
ロボティクスエンジニアとして、複数のスキャンプロジェクトを管理するために、プロファイル機能が欲しい

**受け入れ条件**:
- [ ] 新規プロファイルを作成できる（名前、説明、タグ）
- [ ] プロファイル一覧を表示・検索・フィルタリングできる
- [ ] プロファイルを選択して、そのプロファイルのオブジェクト一覧に遷移できる
- [ ] プロファイルの編集・削除ができる
- [ ] プロファイルのエクスポート・インポートができる

**優先度**: P0（必須）

#### 3. オブジェクトレジストリ（Registry）

**ユーザーストーリー**:
ロボティクスエンジニアとして、スキャン対象の物体を登録・管理するために、オブジェクトレジストリが欲しい

**受け入れ条件**:
- [ ] 新規オブジェクトを登録できる（名前、クラスID、既知寸法、タグ）
- [ ] オブジェクト一覧を表示・検索・フィルタリングできる
- [ ] オブジェクトの詳細情報を表示できる（設定、スキャン履歴、品質メトリクス）
- [ ] オブジェクトごとにパイプライン操作ボタンを表示できる
- [ ] オブジェクトの編集・削除ができる
- [ ] オブジェクトにプレビュー画像・参照画像を追加できる

**優先度**: P0（必須）

#### 4. デバイス管理（Devices）

**ユーザーストーリー**:
ロボティクスエンジニアとして、RealSenseカメラの接続状態を確認し、テスト撮影するために、デバイス管理画面が欲しい

**受け入れ条件**:
- [ ] 接続されているRealSenseデバイスの一覧を表示できる
- [ ] デバイスの詳細情報（シリアル番号、ファームウェア、対応解像度）を表示できる
- [ ] テスト撮影（RGB/Depth）を実行し、プレビューを表示できる
- [ ] デバイスの接続/切断状態をリアルタイムで更新できる
- [ ] カメラ設定（解像度、フレームレート）を変更できる

**優先度**: P0（必須）

#### 5. 撮影計画（Capture Plan）

**ユーザーストーリー**:
ロボティクスエンジニアとして、撮影計画を生成・確認するために、撮影計画画面が欲しい

**受け入れ条件**:
- [ ] 撮影プリセット（Quick/Standard/Hard）を選択できる
- [ ] 生成された撮影計画（視点数、角度、距離）を可視化できる
- [ ] 計画を承認してCaptureステージに進めることができる
- [ ] カスタム設定で計画を生成できる

**優先度**: P0（必須）

#### 6. 撮影（Capture）

**ユーザーストーリー**:
ロボティクスエンジニアとして、RGBDデータを撮影しながら品質を確認するために、撮影画面が欲しい

**受け入れ条件**:
- [ ] RealSenseからのライブプレビュー（RGB/Depth）を表示できる
- [ ] 撮影開始/停止をコントロールできる
- [ ] リアルタイムで品質指標（深度有効率、ブラースコア、カバレッジ）を表示できる
- [ ] 撮影済みフレーム数、キーフレーム数を表示できる
- [ ] 品質ゲート（PASS/WARN/FAIL）をリアルタイムで表示できる
- [ ] 撮影計画に対する進捗（カバレッジ）を可視化できる

**優先度**: P0（必須）

#### 7. 前処理（Preprocess）

**ユーザーストーリー**:
ロボティクスエンジニアとして、撮影データの前処理状況を確認するために、前処理画面が欲しい

**受け入れ条件**:
- [ ] 背景除去方式（深度閾値/床平面推定/手動バウンディング）を選択できる
- [ ] 前処理の実行と進捗を表示できる
- [ ] マスク結果のプレビュー（Before/After）を表示できる
- [ ] マスク品質メトリクスを表示できる
- [ ] 品質ゲート結果を表示し、問題がある場合は再撮影を促す

**優先度**: P0（必須）

#### 8. 3D復元（Reconstruct）

**ユーザーストーリー**:
ロボティクスエンジニアとして、3D復元の進捗と結果を確認するために、復元画面が欲しい

**受け入れ条件**:
- [ ] 復元の実行と進捗（姿勢推定、TSDF統合、メッシュ抽出）を表示できる
- [ ] 復元結果（点群/メッシュ）を3Dビューアで表示できる
- [ ] 復元品質メトリクス（追跡成功率、アライメントRMSE、ドリフト）を表示できる
- [ ] 品質ゲート結果を表示し、問題がある場合は再撮影を促す

**優先度**: P0（必須）

#### 9. アセット最適化（Optimize）

**ユーザーストーリー**:
ロボティクスエンジニアとして、メッシュの最適化状況を確認するために、最適化画面が欲しい

**受け入れ条件**:
- [ ] 最適化オプション（スケール、軸正規化、LOD設定）を設定できる
- [ ] 最適化の実行と進捗を表示できる
- [ ] LOD0/LOD1/LOD2のプレビューを切り替えて表示できる
- [ ] 衝突メッシュのプレビューを表示できる
- [ ] アセット品質メトリクス（三角形数、穴面積率、非多様体エッジ数）を表示できる

**優先度**: P0（必須）

#### 10. パッケージング（Package）

**ユーザーストーリー**:
ロボティクスエンジニアとして、最適化されたアセットをエクスポートするために、パッケージング画面が欲しい

**受け入れ条件**:
- [ ] 出力形式（フォルダ/ZIP）を選択できる
- [ ] 出力先を指定できる
- [ ] パッケージングの実行と進捗を表示できる
- [ ] 生成されたマニフェストの内容を確認できる
- [ ] ダウンロードリンクを提供できる

**優先度**: P0（必須）

#### 11. 品質レポート（Report）

**ユーザーストーリー**:
ロボティクスエンジニアとして、生成されたアセットの品質を確認するために、品質レポート画面が欲しい

**受け入れ条件**:
- [ ] キャプチャ・復元・アセットの各品質メトリクスを表形式で表示できる
- [ ] 総合品質判定（PASS/WARN/FAIL）を大きく表示できる
- [ ] 問題がある場合は、推奨アクションを表示できる
- [ ] レポートをPDF/Markdownでエクスポートできる

**優先度**: P0（必須）

#### 12. 設定（Settings）

**ユーザーストーリー**:
ロボティクスエンジニアとして、アプリケーション全体の設定を管理するために、設定画面が欲しい

**受け入れ条件**:
- [ ] デフォルトの出力プリセット（座標系、単位、テクスチャ解像度）を設定できる
- [ ] 品質ゲートの閾値をカスタマイズできる
- [ ] データ保存先のパスを設定できる
- [ ] システム情報（CPU/GPU/メモリ/ディスク）を表示できる
- [ ] ログレベルを変更できる

**優先度**: P0（必須）

### 将来的な機能（Post-MVP）

#### ターンテーブル連携UI

ターンテーブルの回転制御とスキャンを連携するUI

**優先度**: P1（重要）

#### IMU連携UI

カメラIMUデータの可視化と姿勢補正設定

**優先度**: P1（重要）

#### バッチ処理

複数オブジェクトの一括スキャン・処理機能

**優先度**: P2（できれば）

#### 比較ビューア

異なるスキャン結果を並べて比較する機能

**優先度**: P2（できれば）

## 非機能要件

### パフォーマンス
- **ページ読み込み時間**: 3秒以内（ネットワーク遅延除く）
- **ライブプレビュー**: 15fps以上でRGB/Depth映像を表示
- **3Dビューア**: 100k三角形のメッシュを60fpsで表示
- **進捗更新**: 1秒以内に画面に反映

### ユーザビリティ
- **初回セットアップ**: READMEを読んで15分以内にアプリを起動できる
- **操作習得**: hsr-perception-robocup経験者が15分以内に全機能を把握できる
- **エラーメッセージ**: すべてのエラーに対して、原因と解決策を日本語で表示
- **レスポンシブ対応**: 1280x720以上の解像度で正常に表示

### 信頼性
- **データ損失ゼロ**: ブラウザクラッシュ時も撮影データは保持される
- **セッション復旧**: アプリ再起動後も前回の状態から再開できる
- **自動保存**: 設定変更は自動的に永続化される

### セキュリティ・プライバシー
- **ローカル完結（必須）**: すべての処理はローカルマシン上で完結。外部サーバーへのデータ送信は一切行わない
- **オフライン動作**: インターネット接続なしで全機能が動作する
- **入力検証**: ファイルパス等の入力は適切にサニタイズされる

### 互換性
- **対応OS**: Ubuntu 22.04 LTS、Ubuntu 24.04 LTS（Docker経由）
- **対応ブラウザ**: Chrome 120+、Firefox 120+、Edge 120+
- **対応カメラ**: Intel RealSense D400シリーズ（D415、D435、D455）

### 実行環境
- **Docker必須**: すべての機能はDockerコンテナ内で動作する
- **CPU環境対応**: GPU非搭載でも動作可能（処理速度は低下）
- **GPU対応（オプション）**: NVIDIA GPU + CUDA 12.x で高速化
- **必要メモリ**: 8GB以上（推奨16GB）
- **必要ディスク**: 20GB以上の空き容量

## スコープ外

明示的にスコープ外とする項目:

- **CLIの置き換え**: GUIはCLIを補完するもので、CLIは引き続き利用可能
- **シミュレータ固有フォーマット生成**: URDF、SDF、USDのラッパ生成は別ツール（Sim Pack）の責務
- **クラウド処理**: すべてローカルで完結する
- **モバイル対応**: スマートフォン・タブレットでの操作は対象外
- **マルチユーザー同時アクセス**: シングルユーザー前提
- **リアルタイム3D復元**: 撮影後のバッチ処理を前提とする
